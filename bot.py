import logging
import random
from collections import Counter
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes


logging.basicConfig(
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s", level=logging.INFO
)
logger = logging.getLogger(__name__)


TOKEN = "8409337611:AAEyig2Zx1zURjyHwD5D9hTyolEykZAp38Y"  # <-- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–¥–µ—Å—å –≤–∞—à –Ω–∞—Å—Ç–æ—è—â–∏–π —Ç–æ–∫–µ–Ω


QUIZ_DATA = {
    1: {
        "question": "–ß—Ç–æ —Ç—ã —Å–µ–≥–æ–¥–Ω—è –µ–ª –Ω–∞ –∑–∞–≤—Ç—Ä–∞–∫?",
        "answers": {
            "–ö–æ—Ñ–µ. –ú–Ω–æ–≥–æ –∫–æ—Ñ–µ.": "–í–µ—á–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å",
            "–ó–∞–≤—Ç—Ä–∞–∫? –Ø –µ–≥–æ –ø—Ä–æ—Å–ø–∞–ª(–∞).": "–°–ø—è—â–∞—è –∫—Ä–∞—Å–∞–≤–∏—Ü–∞",
            "–°—Ö–≤–∞—Ç–∏–ª(–∞) —á—Ç–æ-—Ç–æ –Ω–∞ –±–µ–≥—É, –Ω–µ –ø–æ–º–Ω—é —á—Ç–æ.": "–î–µ—Å—è—Ç—å –ú–∏–Ω—É—Ç –∏ –ë—É–¥—É",
            "–û–≤—Å—è–Ω–∫—É, –¥—É–º–∞—è –æ —Å–º—ã—Å–ª–µ –±—ã—Ç–∏—è.": "–ê –º–æ–∂–Ω–æ –≤–æ–ø—Ä–æ—Å"
        }
    },
    2: {
        "question": "–¢–≤–æ–π –ø–ª–µ–π–ª–∏—Å—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–æ—Å—Ç–æ–∏—Ç –∏–∑...",
        "answers": {
            "–°–∞—É–Ω–¥—Ç—Ä–µ–∫–∏ –∏–∑ –≤–∏–¥–µ–æ –∏ —Å—Ç–∞—Ä—ã–µ —Ö–∏—Ç—ã.": "–ì–ª–∞–≤–Ω—ã–π –ø–æ –º–µ–º–∞–º",
            "–ë–æ–¥—Ä–∞—è –º—É–∑—ã–∫–∞ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫.": "–í–µ—á–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å",
            "–í—Å–µ–≥–æ –ø–æ–Ω–µ–º–Ω–æ–≥—É, —á—Ç–æ–±—ã –ø–æ–¥–ø–µ–≤–∞—Ç—å.": "–î—É—à–∞ –∫–æ–º–ø–∞–Ω–∏–∏",
            "–°–ø–æ–∫–æ–π–Ω—ã–µ –º–µ–ª–æ–¥–∏–∏ –∏–ª–∏ –∑–≤—É–∫–∏ –¥–æ–∂–¥—è.": "–°–ø—è—â–∞—è –∫—Ä–∞—Å–∞–≤–∏—Ü–∞"
        }
    },
    3: {
        "question": "–ö–∞–∫ —Ç—ã –ø–æ–≤–µ–¥–µ—à—å —Å–µ–±—è, –µ—Å–ª–∏ –æ–∫–∞–∂–µ—à—å—Å—è –≤ –Ω–µ–∑–Ω–∞–∫–æ–º–æ–π –∫–æ–º–ø–∞–Ω–∏–∏?",
        "answers": {
            "–ß–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç —Ç—Ä–∞–≤–ª—é –∞–Ω–µ–∫–¥–æ—Ç—ã.": "–î—É—à–∞ –∫–æ–º–ø–∞–Ω–∏–∏",
            "–ù–∞–π–¥—É —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ –¥–ª—è –≥–ª—É–±–æ–∫–æ–π –¥–∏—Å–∫—É—Å—Å–∏–∏.": "–ú–∞—Å—Ç–µ—Ä –ö–∞–≤–µ—Ä–∑–Ω—ã—Ö –í–æ–ø—Ä–æ—Å–æ–≤",
            "–ë—É–¥—É —Å–∫—Ä–æ–º–Ω–æ —Å—Ç–æ—è—Ç—å –≤ —Å—Ç–æ—Ä–æ–Ω–µ.": "–ê –º–æ–∂–Ω–æ –≤–æ–ø—Ä–æ—Å",
            "–ü–æ–∫–∞–∂—É —Å–º–µ—à–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞.": "–ì–ª–∞–≤–Ω—ã–π –ø–æ –º–µ–º–∞–º"
        }
    },
    4: {
        "question": "–ö–∞–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Ç–≤–æ–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω–µ —Å–∞–º–æ–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ?",
        "answers": {
            "TikTok / –ö–∞–Ω–∞–ª—ã —Å –º–µ–º–∞–º–∏.": "–ì–ª–∞–≤–Ω—ã–π –ø–æ –º–µ–º–∞–º",
            "–ë—É–¥–∏–ª—å–Ω–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ—Å—Ç–∞–≤–ª—è—é 10 —Ä–∞–∑.": "–°–ø—è—â–∞—è –∫—Ä–∞—Å–∞–≤–∏—Ü–∞",
            "–ö–∞—Ä—Ç—ã/–Ω–∞–≤–∏–≥–∞—Ç–æ—Ä, —á—Ç–æ–±—ã –≤–µ–∑–¥–µ —É—Å–ø–µ—Ç—å.": "–î–µ—Å—è—Ç—å –ú–∏–Ω—É—Ç –∏ –ë—É–¥—É",
            "–ö–∞–ª–µ–Ω–¥–∞—Ä—å, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å –≤—Å–µ –¥–µ–ª–∞.": "–í–µ—á–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å"
        }
    },
    5: {
        "question": "–¢–≤–æ—è –∏–¥–µ–∞–ª—å–Ω–∞—è —Å—É–±–±–æ—Ç–∞ ‚Äî —ç—Ç–æ...",
        "answers": {
            "–ü—Ä–æ—Å–Ω—É—Ç—å—Å—è –≤ –æ–±–µ–¥ –∏ —Å–Ω–æ–≤–∞ —É—Å–Ω—É—Ç—å.": "–°–ø—è—â–∞—è –∫—Ä–∞—Å–∞–≤–∏—Ü–∞",
            "–ì–æ—Ä—ã, –≤–µ–ª–æ—Å–∏–ø–µ–¥ –∏ –≤–µ—á–µ—Ä–∏–Ω–∫–∞.": "–í–µ—á–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å",
            "–°–æ–±—Ä–∞—Ç—å –¥—Ä—É–∑–µ–π –Ω–∞ —à–∞—à–ª—ã–∫–∏/–Ω–∞—Å—Ç–æ–ª–∫–∏.": "–î—É—à–∞ –∫–æ–º–ø–∞–Ω–∏–∏",
            "–ü–æ–π—Ç–∏ –Ω–∞ –ª–µ–∫—Ü–∏—é –∏ —Å–ø–æ—Ä–∏—Ç—å –¥–æ –Ω–æ—á–∏.": "–ú–∞—Å—Ç–µ—Ä –ö–∞–≤–µ—Ä–∑–Ω—ã—Ö –í–æ–ø—Ä–æ—Å–æ–≤"
        }
    },
    6: {
        "question": "–ß—Ç–æ –±—ã —Ç—ã —Å–¥–µ–ª–∞–ª, –µ—Å–ª–∏ –±—ã –≤ —Å—É—Ç–∫–∞—Ö –±—ã–ª–æ 25 —á–∞—Å–æ–≤?",
        "answers": {
            "–°–ø–∞–ª(–∞) –±—ã –Ω–∞ —á–∞—Å –¥–æ–ª—å—à–µ.": "–°–ø—è—â–∞—è –∫—Ä–∞—Å–∞–≤–∏—Ü–∞",
            "–£—Å–ø–µ–ª(–∞) –±—ã —Å–¥–µ–ª–∞—Ç—å –µ—â—ë –æ–¥–Ω–æ –¥–µ–ª–æ.": "–í–µ—á–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å",
            "–ü–µ—Ä–µ—Å—Ç–∞–ª(–∞) –±—ã –æ–ø–∞–∑–¥—ã–≤–∞—Ç—å (–Ω–∞–≤–µ—Ä–Ω–æ–µ).": "–î–µ—Å—è—Ç—å –ú–∏–Ω—É—Ç –∏ –ë—É–¥—É",
            "–õ–∏—à–Ω–∏–π —á–∞—Å, —á—Ç–æ–±—ã –≤–∏—Ç–∞—Ç—å –≤ –æ–±–ª–∞–∫–∞—Ö.": "–ê –º–æ–∂–Ω–æ –≤–æ–ø—Ä–æ—Å"
        }
    },
    7: {
        "question": "–¢–≤–æ–π –ª—é–±–∏–º—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂ –∏–∑ –º—É–ª—å—Ç—Ñ–∏–ª—å–º–∞?",
        "answers": {
            "–ë–µ–ª—ã–π –ö—Ä–æ–ª–∏–∫ –∏–∑ ¬´–ê–ª–∏—Å—ã¬ª, –≤–µ—á–Ω–æ —Å–ø–µ—à–∏—Ç.": "–î–µ—Å—è—Ç—å –ú–∏–Ω—É—Ç –∏ –ë—É–¥—É",
            "–û—Å–µ–ª –∏–∑ ¬´–®—Ä–µ–∫–∞¬ª, –¥—É—à–∞ –∫–æ–º–ø–∞–Ω–∏–∏.": "–î—É—à–∞ –∫–æ–º–ø–∞–Ω–∏–∏",
            "–î–∂–∏–Ω–Ω –∏–∑ ¬´–ê–ª–∞–¥–¥–∏–Ω–∞¬ª, –º–∞—Å—Ç–µ—Ä —à—É—Ç–æ–∫.": "–ì–ª–∞–≤–Ω—ã–π –ø–æ –º–µ–º–∞–º",
            "–®–µ—Ä–ª–æ–∫ –•–æ–ª–º—Å, –≤–∞–∂–Ω–∞ –ª–æ–≥–∏–∫–∞ –∏ –∏—Å—Ç–∏–Ω–∞.": "–ú–∞—Å—Ç–µ—Ä –ö–∞–≤–µ—Ä–∑–Ω—ã—Ö –í–æ–ø—Ä–æ—Å–æ–≤"
        }
    },
    8: {
        "question": "–ö–∞–∫ —Ç—ã —Å–æ–±–∏—Ä–∞–µ—à—å —á–µ–º–æ–¥–∞–Ω –≤ –ø–æ–µ–∑–¥–∫—É?",
        "answers": {
            "–ó–∞ 15 –º–∏–Ω—É—Ç –¥–æ –≤—ã—Ö–æ–¥–∞, –∫–∏–¥–∞—è –≤—Å—ë –ø–æ–¥—Ä—è–¥.": "–î–µ—Å—è—Ç—å –ú–∏–Ω—É—Ç –∏ –ë—É–¥—É",
            "–£ –º–µ–Ω—è –≤—Å–µ–≥–¥–∞ —Å–æ–±—Ä–∞–Ω ¬´—Ç—Ä–µ–≤–æ–∂–Ω—ã–π —á–µ–º–æ–¥–∞–Ω—á–∏–∫¬ª.": "–í–µ—á–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å",
            "–°–æ—Å—Ç–∞–≤–ª—è—é —Å–ø–∏—Å–æ–∫, –Ω–æ –≤–µ—á–Ω–æ –æ—Ç–≤–ª–µ–∫–∞—é—Å—å.": "–ê –º–æ–∂–Ω–æ –≤–æ–ø—Ä–æ—Å",
            "–ù–∞—á–∏–Ω–∞—é –∑–∞ –Ω–µ–¥–µ–ª—é, –Ω–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –º–µ–¥–∏—Ç–∏—Ä—É—é.": "–°–ø—è—â–∞—è –∫—Ä–∞—Å–∞–≤–∏—Ü–∞"
        }
    },
    9: {
        "question": "–ö–∞–∫ —Ç—ã —Ä–µ–∞–≥–∏—Ä—É–µ—à—å –Ω–∞ —Å–ø–æ—Ä –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ?",
        "answers": {
            "–í–º–µ—à–∏–≤–∞—é—Å—å —Å —Ñ–∞–∫—Ç–∞–º–∏ –∏ —Å—Å—ã–ª–∫–∞–º–∏.": "–ú–∞—Å—Ç–µ—Ä –ö–∞–≤–µ—Ä–∑–Ω—ã—Ö –í–æ–ø—Ä–æ—Å–æ–≤",
            "–û—Ç–ø—Ä–∞–≤–ª—è—é –º–µ–º, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π —Å–∏—Ç—É–∞—Ü–∏—é.": "–ì–ª–∞–≤–Ω—ã–π –ø–æ –º–µ–º–∞–º",
            "–ü—ã—Ç–∞—é—Å—å –≤—Å–µ—Ö –ø–æ–º–∏—Ä–∏—Ç—å –∏ –Ω–∞–π—Ç–∏ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å.": "–î—É—à–∞ –∫–æ–º–ø–∞–Ω–∏–∏",
            "–ù–∞–±–ª—é–¥–∞—é —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã —Å –ø–æ–ø–∫–æ—Ä–Ω–æ–º.": "–ê –º–æ–∂–Ω–æ –≤–æ–ø—Ä–æ—Å"
        }
    },
    10: { # –ó–¥–µ—Å—å –¥–µ–≤–∏–∑—ã, –æ–Ω–∏ –∫–æ—Ä–æ—Ç–∫–∏–µ, –æ—Å—Ç–∞–≤–ª—è–µ–º –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        "question": "–ï—Å–ª–∏ –±—ã —Ç–µ–±–µ –Ω—É–∂–Ω–æ –±—ã–ª–æ –≤—ã–±—Ä–∞—Ç—å –¥–µ–≤–∏–∑, –∫–∞–∫–æ–π –±—ã —Ç—ã –≤—ã–±—Ä–∞–ª?",
        "answers": {
            "¬´–õ—É—á—à–µ –ø–æ–∑–¥–Ω–æ, —á–µ–º –Ω–∏–∫–æ–≥–¥–∞¬ª.": "–î–µ—Å—è—Ç—å –ú–∏–Ω—É—Ç –∏ –ë—É–¥—É",
            "¬´–ê —á—Ç–æ, –µ—Å–ª–∏...?¬ª": "–ú–∞—Å—Ç–µ—Ä –ö–∞–≤–µ—Ä–∑–Ω—ã—Ö –í–æ–ø—Ä–æ—Å–æ–≤",
            "¬´–î–≤–∏–∂–µ–Ω–∏–µ - –∂–∏–∑–Ω—å!¬ª": "–í–µ—á–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å",
            "¬´–ï—â–µ –ø—è—Ç—å –º–∏–Ω—É—Ç–æ—á–µ–∫...¬ª": "–°–ø—è—â–∞—è –∫—Ä–∞—Å–∞–≤–∏—Ü–∞"
        }
    },
    11: {
        "question": "–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ –≤—ã —Å –¥—Ä—É–∑—å—è–º–∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –æ—á–µ–Ω—å –∑–∞–ø—É—Ç–∞–Ω–Ω—ã–π —Ñ–∏–ª—å–º. –ö–∞–∫–∞—è —Ñ—Ä–∞–∑–∞ –æ—Ç —Ç–µ–±—è –ø—Ä–æ–∑–≤—É—á–∏—Ç —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ?",
        "answers": {
            "–°–º–æ—Ç—Ä–∏—Ç–µ! –≠—Ç–æ –∂–µ —Ç–æ—Ç —Å–∞–º—ã–π –º–µ–º!": "–ì–ª–∞–≤–Ω—ã–π –ø–æ –º–µ–º–∞–º",
            "–û, –æ–±–æ–∂–∞—é —ç—Ç–æ–≥–æ –∞–∫—Ç–µ—Ä–∞!": "–î—É—à–∞ –∫–æ–º–ø–∞–Ω–∏–∏",
            "–ü–æ–¥–æ–∂–¥–∏—Ç–µ, —è —á—Ç–æ-—Ç–æ —É–ø—É—Å—Ç–∏–ª...": "–ê –º–æ–∂–Ω–æ –≤–æ–ø—Ä–æ—Å",
            "–°—Ç–æ–ø, —ç—Ç–æ –∂–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–ª–æ–≥–∏—á–Ω–æ!": "–ú–∞—Å—Ç–µ—Ä –ö–∞–≤–µ—Ä–∑–Ω—ã—Ö –í–æ–ø—Ä–æ—Å–æ–≤"
        }
    }
}

RESULTS = {
    "–°–ø—è—â–∞—è –∫—Ä–∞—Å–∞–≤–∏—Ü–∞": "–ü—Ä–æ—Å–ø–∞–ª –≤—Å–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∏ –≤—Å—Ç—Ä–µ—á–∏, –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –≤ –∫—É—Ä—Å–µ –≤—Å–µ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—â–µ–≥–æ.",
    "–ì–ª–∞–≤–Ω—ã–π –ø–æ –º–µ–º–∞–º": "90% –≤—Å–µ–≥–æ –º–µ–º–Ω–æ–≥–æ –≤ —á–∞—Ç–µ –∏–¥—ë—Ç –æ—Ç —Ç–µ–±—è, –≥–ª–∞–≤–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ä–æ—Ñ–ª–æ–≤ –∏ —Ö–æ—Ö–º—ã.",
    "–î—É—à–∞ –∫–æ–º–ø–∞–Ω–∏–∏": "–ó–Ω–∞–µ—Ç –≤—Å–µ—Ö –∏ –∫–∞–∂–¥–æ–≥–æ, –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞ –ø–æ–º–Ω–∏—Ç, –∑–∞—á–µ–º –ø—Ä–∏—à–µ–ª –Ω–∞ –®–ö.",
    "–ê –º–æ–∂–Ω–æ –≤–æ–ø—Ä–æ—Å": "–¢—ã —á–∞—Å—Ç–æ –ª–µ—Ç–∞–µ—à—å –≤ –æ–±–ª–∞–∫–∞—Ö, –Ω–æ —Å—Ç–∞—Ä–∞–µ—à—å—Å—è –±—ã—Ç—å –≤ –∫—É—Ä—Å–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—â–µ–≥–æ.",
    "–í–µ—á–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å": "–£—á–∞—Å—Ç–≤—É–µ—Ç –≤–æ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—è—Ö, –¥–∞–∂–µ –≤ —Ç–µ—Ö, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç. –ó–∞ –ª—é–±–æ–π –¥–≤–∏–∂, –∫—Ä–æ–º–µ –Ω–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ.",
    "–î–µ—Å—è—Ç—å –ú–∏–Ω—É—Ç –∏ –ë—É–¥—É": "–û–ø–æ–∑–¥–∞–ª —Ç–æ—á–Ω–æ –Ω–µ –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑. –¢—ã –∂–∏–≤–æ–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ —Ç–æ–≥–æ, —á—Ç–æ –≤—Ä–µ–º—è —Ä–∞—Å—Ç—è–∂–∏–º–æ. –¢–≤–æ–µ ¬´–ª–µ—á—É, —â–∞—Å –±—É–¥—É¬ª –º–æ–∂–Ω–æ —Å–º–µ–ª–æ —É–º–Ω–æ–∂–∞—Ç—å –Ω–∞ –¥–≤–∞, –∞ —Ç–æ –∏ –Ω–∞ —Ç—Ä–∏.",
    "–ú–∞—Å—Ç–µ—Ä –ö–∞–≤–µ—Ä–∑–Ω—ã—Ö –í–æ–ø—Ä–æ—Å–æ–≤": "–¢–≤–æ–µ –ª—é–±–∏–º–æ–µ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–µ - –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ª–µ–∫—Ç–æ—Ä–∞ –≤ —Ç—É–ø–∏–∫ –≤–æ–ø—Ä–æ—Å–æ–º, –Ω–∞—á–∏–Ω–∞—é—â–∏–º—Å—è —Å–æ —Å–ª–æ–≤ '–ê —á—Ç–æ, –µ—Å–ª–∏...'. –û–±–æ–∂–∞–µ—à—å —Å–ø–æ—Ä—ã ( –æ—Å–æ–±–µ–Ω–Ω–æ –≥—Ä–∏–±–æ–≤) –∏ –∑–¥–æ—Ä–æ–≤—É—é (–∏ –Ω–µ –æ—á–µ–Ω—å) –¥–∏—Å–∫—É—Å—Å–∏—é."
}


IMAGE_CACHE = {}


def preload_images():

    logger.info("–ù–∞—á–∏–Ω–∞—é –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –∫–µ—à...")
    for persona in RESULTS:
        try:
            path = f"images/{persona}.jpg"
            with open(path, 'rb') as f:
                IMAGE_CACHE[persona] = f.read()
            logger.info(f"  - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ '{persona}.jpg' —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ.")
        except FileNotFoundError:
            logger.warning(f"  - –í–ù–ò–ú–ê–ù–ò–ï: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ '{persona}.jpg' –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.")
    logger.info("–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∞.")


async def error_handler(update: object, context: ContextTypes.DEFAULT_TYPE) -> None:
    logger.error("Exception while handling an update:", exc_info=context.error)


async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    keyboard = [[InlineKeyboardButton("–ù–∞—á–∞—Ç—å –∫–≤–∏–∑", callback_data='start_quiz')]]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await update.message.reply_text('–ü—Ä–∏–≤–µ—Ç! –ì–æ—Ç–æ–≤(–∞) —É–∑–Ω–∞—Ç—å, –∫—Ç–æ —Ç—ã —Å–µ–≥–æ–¥–Ω—è? –ù–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.',
                                    reply_markup=reply_markup)


async def send_question(update: Update, context: ContextTypes.DEFAULT_TYPE, question_id: int):
    question_data = QUIZ_DATA[question_id]
    question_text = question_data["question"]
    answers = question_data["answers"]

    keyboard = []
    for answer_text, persona in answers.items():
        callback_data = f"answer_{question_id}_{persona}"
        keyboard.append([InlineKeyboardButton(answer_text, callback_data=callback_data)])

    reply_markup = InlineKeyboardMarkup(keyboard)

    try:
        if update.callback_query and update.callback_query.data in ['start_quiz', 'restart_quiz']:
            await context.bot.delete_message(chat_id=update.effective_chat.id,
                                             message_id=update.callback_query.message.message_id)
            await context.bot.send_message(chat_id=update.effective_chat.id, text=question_text,
                                           reply_markup=reply_markup)
        else:
            await update.callback_query.edit_message_text(text=question_text, reply_markup=reply_markup)
    except Exception as e:
        logger.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –≤–æ–ø—Ä–æ—Å: {e}")


async def button(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    await query.answer()

    user_id = query.from_user.id

    if 'user_data' not in context.user_data:
        context.user_data['user_data'] = {'current_question': 0, 'answers': []}

    user_data = context.user_data['user_data']

    if query.data == 'start_quiz' or query.data == 'restart_quiz':
        user_data['current_question'] = 1
        user_data['answers'] = []
        await send_question(update, context, 1)

    elif query.data.startswith('answer_'):
        parts = query.data.split('_')
        question_id_str = parts[1]
        persona = "_".join(parts[2:])
        question_id = int(question_id_str)

        user_data['answers'].append(persona)

        next_question_id = question_id + 1
        if next_question_id in QUIZ_DATA:
            user_data['current_question'] = next_question_id
            await send_question(update, context, next_question_id)
        else:
            context.application.create_task(show_results(update, context))


async def show_results(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_answers = context.user_data['user_data']['answers']

    counts = Counter(user_answers)
    max_count = max(counts.values())
    top_personas = [persona for persona, count in counts.items() if count == max_count]
    final_persona = random.choice(top_personas)
    description = RESULTS[final_persona]

    try:
        await context.bot.delete_message(chat_id=update.effective_chat.id,
                                         message_id=update.callback_query.message.message_id)

        await context.bot.send_message(
            chat_id=update.effective_chat.id,
            text=f"üéâ *–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç:* {final_persona}\n\n{description}",
            parse_mode='Markdown'
        )


        if final_persona in IMAGE_CACHE:
            await context.bot.send_photo(
                chat_id=update.effective_chat.id,
                photo=IMAGE_CACHE[final_persona]
            )
        else:
            # –≠—Ç–æ—Ç –±–ª–æ–∫ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–µ –±—ã–ª–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
            logger.warning(f"–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è '{final_persona}' –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –∫–µ—à–µ.")
            await context.bot.send_message(
                chat_id=update.effective_chat.id,
                text="[–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –∫–∞—Ä—Ç–∏–Ω–∫–∞ –¥–ª—è —ç—Ç–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞]"
            )

        keyboard = [[InlineKeyboardButton("–ü—Ä–æ–π—Ç–∏ –µ—â–µ —Ä–∞–∑!", callback_data='restart_quiz')]]
        reply_markup = InlineKeyboardMarkup(keyboard)
        await context.bot.send_message(
            chat_id=update.effective_chat.id,
            text="–•–æ—Ç–∏—Ç–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞?",
            reply_markup=reply_markup
        )
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫–∞–∑–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: {e}")

    context.user_data['user_data'] = {'current_question': 0, 'answers': []}


def main() -> None:

    preload_images()

    application = Application.builder().token(TOKEN).build()

    application.add_error_handler(error_handler)
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CallbackQueryHandler(button))

    logger.info("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –Ω–∞–≥—Ä—É–∑–∫–µ...")
    application.run_polling()


if __name__ == '__main__':
    main()